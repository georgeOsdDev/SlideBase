// Generated by CoffeeScript 1.3.3
/*
SlideBaseClient.js
------------------------------------------------
author:  [Takeharu Oshida](http://about.me/takeharu.oshida)
version: 0.1
licence: [MIT](http://opensource.org/licenses/mit-license.php)
*/(function(){var e;console.log("This is Client Side Script"),window.sbClient={admin:!1,lock:!1,page:{current:0,last:null},Model:{},Collection:{},View:{},Instances:{},option:{animation:"",theme:"default"},plugins:{},pushMethods:{move:!0},isDisplayHelp:!1,userList:{},init:function(e){var t,n,r;return e==null&&(e={}),_.each(e,function(e,t){return sbClient.option[t]=e}),r=document.createElement("div"),r.id="wrap",r.display="none",t=document.createElement("div"),t.id="ctl",$(t).addClass("ctl").append("<button class='btn' id='back'>&larr;</button><button class='btn' id='next'>&rarr;</button>"),n=document.createElement("div"),n.id="help",$(n).addClass("help hide").append("<h4 id='usage'><span id='close'>âœ–</span>&nbsp;Usage</h4>"),$("body").append(r).append(t).append(n),$("#close").bind("click",function(){return $("#help").addClass("hide"),sbClient.isDisplayHelp=!1}),this.Instances.slideView=new sbClient.View.Slide},resizeSlide:function(){return $(".slide").each(function(){return $(this).css({height:$(window).height()-72,width:$(window).width()-72})})},execEmit:function(e,t){var n;return console.log("execEmit "+e),n={name:"plugin",plugin:{name:e},data:t},$("body").trigger("execEmit",n)},isEnableServerPush:function(e){return this.pushMethods[e]},isEnablePlugin:function(e){return!e.plugin||!e.plugin.name?!1:this.isEnableServerPush(e.plugin.name)},move:function(e){if(this.isEnableServerPush("move"))return this.Instances.slideView.trigger("execMove",e.data)},setUserList:function(e){return this.userList=e},nextSlide:function(e){var t;return t=document.createElement("div"),t.id="slide_"+e.get("page"),$(t).addClass(e.get("class")).addClass("slide current").append(e.get("elements"))},simpleMove:function(e){var t;return t=this.nextSlide(e),$("#wrap").empty().removeClass().append(t),this.resizeSlide(),this.lock=!1},fadeMove:function(e){var t;return t=this.nextSlide(e),$("#wrap").fadeOut(250,function(){return $("#wrap").empty().removeClass().append(t),sbClient.resizeSlide()}),$("#wrap").fadeIn(500,function(){return this.lock=!1})},positionMove:function(e,t,n,r,i){return r<0&&(r+=1),$("#wrap > .slide").each(function(r,s){var o,u,a,f;return u=e*(r-i),a=t*(r-i),f=n*(r-i),o={transform:"translate3d("+u+"px,"+a+"px,"+f+"px)"},$(s).css(o)})},horizontalMove:function(e,t){return this.positionMove($(window).width(),0,0,e,t),this.lock=!1},verticalMove:function(e,t){return this.positionMove(0,$(window).height(),0,e,t),this.lock=!1}},sbClient.Model.Slide=Backbone.Model.extend({elements:"","class":"",page:""}),sbClient.Collection.Slides=Backbone.Collection.extend({model:sbClient.Model.Slide,fetch:function(){var e;return e=this,_($("section")).each(function(t,n){var r;return r=new sbClient.Model.Slide({elements:$(t).contents(),"class":$(t).attr("class"),page:n}),e.add(r),$(t).remove()}),sbClient.page.last=e.length,e.trigger("ready")}}),sbClient.View.Slide=Backbone.View.extend({el:$("body"),initialize:function(){var e;return e=this,e.collection=new sbClient.Collection.Slides,_.bindAll(this,"render","dispHelp","moveSlide","handleKey"),e.$el.bind("keydown",e.handleKey),e.$el.bind("swipeleft",e.moveSlide(1)),e.$el.bind("swiperight",e.moveSlide(-1)),$("#next").bind("click",function(){return e.moveSlide(1)}),$("#back").bind("click",function(){return e.moveSlide(-1)}),e.on("execMove",function(t){var n,r;n=Array.prototype.slice.apply(arguments),r=n[0];if(r.currentPage===sbClient.page.current)return e.moveSlide(r.direction)}),e.collection.on("ready",function(){return e.render()}),e.collection.fetch()},render:function(){var e,t,n;n=this,e=function(e,t,r){var i,s,o;return s=n.collection.where({page:t})[0],i=s.get("page"),o=document.createElement("div"),o.id="slide_"+i,$(o).addClass(e).addClass(s.get("class")).append(s.get("elements")),r&&$(o).css(r),sbClient.resizeSlide(),$("#wrap").append($(o))},t=function(t,r,i){return n.collection.each(function(n,s){var o;return o={transform:"translate3d("+t*s+"px,"+r*s+"px,"+i*s+"px)"},s===0?(e("slide current transform",0,o),location.hash=s):e("slide transform",s,o)})};switch(sbClient.option.animation){case"horizontal":t($(window).width(),0,0);break;case"vertical":t(0,$(window).height(),0);break;case"fade":e("slide current",0);break;default:e("slide current",0)}return sbClient.lock=!1},handleKey:function(e){var t,n,r,i,s;r=e.keyCode||e.which,i=e.ctrlKey,t=e.altKey,s=e.shiftKey,n=e.metaKey;if(r===32||r===39){if(sbClient.isDisplayHelp)return;e.preventDefault,this.moveSlide(1)}if(r===8||r===37){if(sbClient.isDisplayHelp)return;e.preventDefault,this.moveSlide(-1)}if((i||n)&&s&&r===191)return e.preventDefault,this.dispHelp()},moveSlide:function(e){var t,n,r,i;i=this;if(sbClient.lock)return;n=sbClient.page.current+e,t=i.collection.at(n);if(t){r={name:"move",data:{direction:e,currentPage:sbClient.page.current}},$("body").trigger("execEmit",r),sbClient.lock=!0;switch(sbClient.option.animation){case"horizontal":sbClient.horizontalMove(e,n);break;case"vertical":sbClient.verticalMove(e,n);break;case"fade":sbClient.fadeMove(t);break;default:sbClient.simpleMove(t)}return sbClient.page.current=n,location.hash=sbClient.page.current,sbClient.lock=!1}},dispHelp:function(){return console.log("Help!"),sbClient.isDisplayHelp?($("#help").removeClass("disp").addClass("hide"),sbClient.isDisplayHelp=!1):($("#help").removeClass("hide").addClass("disp"),sbClient.isDisplayHelp=!0)}}),sbClient.Model.Plugin=Backbone.Model.extend({defaults:{id:"",name:"",callback:"",element:"",initialScript:function(){}},initialize:function(){var e;return e=this,$(function(){var t,n;return t=e.get("name"),sbClient.plugins[t]=e,sbClient.pushMethods[t]=!0,$("#help").append(e.get("element")),n=e.get("initialScript")||{},n()})}}),e=typeof io!="undefined"&&io!==null?io.connect("http://"+location.host):void 0,e!=null&&e.on("error",function(e){return console.error("Unable to connect Socket.IO",e)}),e!=null&&e.on("connect",function(){return console.log("client connected"),$("body").on("execEmit",function(t,n){return e.emit(n.name,n)}),e.on("users",function(e){return sbClient.setUserList(e)}),e.on("move",function(e){return sbClient.move(e)}),e.on("plugin",function(e){var t;if(sbClient.isEnablePlugin(e))return t=sbClient.plugins[e.plugin.name].get("callback")||{},t(e.data)}),e.on("disconnect",function(){return $("body").off("execEmit"),console.log("disconnected Bye!")})}),$(function(){return sbClient.resizeSlide(),$(window).bind("resize",function(){return sbClient.resizeSlide()}),$("a").bind("click",function(e){return e.stopPropagation(),e.preventDefault(),window.open(this.href,"_blank")})})}).call(this);