// Generated by CoffeeScript 1.3.3
/*
SlideBaseClient.js
------------------------------------------------
author:  [Takeharu Oshida](http://about.me/takeharu.oshida)
version: 0.1
licence: [MIT](http://opensource.org/licenses/mit-license.php)
*/(function(){var e,t,n,r,i,s,o,u,a;console.log("This is Client Side Script"),window.sbClient={admin:!1,lock:!1,page:{current:0,last:null},Model:{},Collection:{},View:{},option:{animation:"fade",theme:"default"},plugins:{},pushMethods:{serverpush:!0,move:!0},isDisplayHelp:!1,userList:{},init:function(e){var t,n,r,i,s;return e==null&&(e={}),_.each(e,function(e,t){return sbClient.option[t]=e}),s=document.createElement("div"),s.id="wrap",s.display="none",t=document.createElement("div"),t.id="ctl",$(t).addClass("ctl"),$(t).append("<button class='btn' id='back'>&larr;</button><button class='btn' id='next'>&rarr;</button>"),n=document.createElement("div"),n.id="help",$(n).addClass("help"),$(n).addClass("hide"),$(n).append("<p id='plgunsHead'>Plugins</p>"),$("body").append(s),$("body").append(t),$("body").append(n),$("#plgunsHead").bind("click",function(){return $("#help").addClass("hide"),sbClient.isDisplayHelp=!1}),i=new sbClient.View.SlideView,r=new sbClient.View.PluginView},execEmit:function(e,t){var n;return console.log("execEmit "+e),n={name:"plugin",plugin:{name:e},data:t},$("body").trigger("execEmit",n)}},n=function(e){return sbClient.pushMethods.serverpush===!0&&sbClient.pushMethods[e]===!0},s=function(e){return sbClient.userList=e},r=function(e){return $("body").trigger("execMove",e)},sbClient.Model.Slide=Backbone.Model.extend({elements:"",page:""}),sbClient.Collection.Slides=Backbone.Collection.extend({model:sbClient.Model.Slide}),sbClient.View.SlideView=Backbone.View.extend({el:$("body"),initialize:function(){var e,t;return this.collection=new sbClient.Collection.Slides,e=0,t=this,_.bindAll(this,"render","dispHelp","moveSlide","execMove","handleKey"),t.$el.bind("keydown",t.handleKey),t.$el.bind("swipeleft",t.moveSlide(1)),t.$el.bind("swiperight",t.moveSlide(-1)),$("#next").bind("click",function(){return t.moveSlide(1)}),$("#back").bind("click",function(){return t.moveSlide(-1)}),$("body").on("execMove",function(e,n){return t.execMove(n.data)}),_($(t.el).find("section")).each(function(n){var r;return r=new sbClient.Model.Slide({elements:$(n).children(),page:e}),t.collection.add(r),e++}),sbClient.page.last=e,t.render()},render:function(){var e,t,n;n=this,e=function(e,t,r){var s,o,u;return o=n.collection.at(t),s=o.get("page"),u=document.createElement("div"),u.id="slide_"+s,$(u).addClass(e).append(o.get("elements")),r&&$(u).css(r),i(),$("#wrap").append($(u))},t=function(t,r,i){return $("#wrap").addClass("transform"),n.collection.each(function(n,s){var o;return o={transform:"translate3d("+t*s+"px,"+r*s+"px,"+i*s+"px)"},s===0?e("slide current transform",0,o):e("slide transform",s,o)})};switch(sbClient.option.animation){case"horizontal":t($(window).width(),0,0);break;case"vertical":t(0,$(window).height(),0);break;case"fade":e("slide current",0);break;default:e("slide current",0)}return sbClient.lock=!1},handleKey:function(e){var t,n,r,i,s;r=e.keyCode||e.which,i=e.ctrlKey,t=e.altKey,s=e.shiftKey,n=e.metaKey;if(r===32||r===39){if(sbClient.isDisplayHelp)return;e.preventDefault,this.moveSlide(1)}if(r===8||r===37){if(sbClient.isDisplayHelp)return;e.preventDefault,this.moveSlide(-1)}if((i||n)&&s&&r===191)return e.preventDefault,this.dispHelp()},moveSlide:function(n){var r,i,s;if(sbClient.lock)return;i=sbClient.page.current+n,r=this.collection.at(i);if(r){s={name:"move",data:{direction:n,currentPage:sbClient.page.current}},$("body").trigger("execEmit",s),sbClient.lock=!0;switch(sbClient.option.animation){case"horizontal":t(n,i);break;case"vertical":a(n,i);break;case"fade":e(r);break;default:e(r)}return sbClient.page.current=i,sbClient.lock=!1}},execMove:function(e){if(e.currentPage===sbClient.page.current)return this.moveSlide(e.direction)},dispHelp:function(){return console.log("Help!"),sbClient.isDisplayHelp?($("#help").removeClass("disp").addClass("hide"),sbClient.isDisplayHelp=!1):($("#help").removeClass("hide").addClass("disp"),sbClient.isDisplayHelp=!0)}}),i=function(){return $(".slide").each(function(){return $(this).css({height:$(window).height()-72,width:$(window).width()-72})})},e=function(e){return $(".slide").fadeOut(250,function(){return $(".slide").empty(),$(".slide").append(e.get("elements"))}),$(".slide").fadeIn(500,function(){return sbClient.lock=!1})},o=function(e,t,n,r,i){return r<0&&(r+=1),$("#wrap > .slide").each(function(r,s){var o,u,a,f;return u=e*(r-i),a=t*(r-i),f=n*(r-i),o={transform:"translate3d("+u+"px,"+a+"px,"+f+"px)"},$(s).css(o)})},t=function(e,t){return o($(window).width(),0,0,e,t),sbClient.lock=!1},a=function(e,t){return o(0,$(window).height(),0,e,t),sbClient.lock=!1},sbClient.Model.Plugin=Backbone.Model.extend({defaults:{name:"",callback:"",element:"",initialScript:function(){}}}),sbClient.plugins.serverpush=new sbClient.Model.Plugin({name:"serverpush",element:"<div id='#serverpush' class='pluginOption'>\n  <input type='checkbox' name='serverpushCheck' value='enable' checked>ServerPush\n</div>",initialScript:function(){return $('[name="serverpushCheck"]').bind("change",function(){return sbClient.pushMethods.serverpush=$(this).attr("checked")==="checked"})}}),sbClient.Collection.Plugins=Backbone.Collection.extend({model:sbClient.Model.Plugin,fetch:function(){var e;return e=this,_.each(sbClient.plugins,function(t){return e.add(t),sbClient.pushMethods[t.get("name")]=!0})}}),sbClient.View.PluginView=Backbone.View.extend({el:$("#help"),initialize:function(){var e;return console.log("initialize plugins"),e=this,this.collection=new sbClient.Collection.Plugins,_.bindAll(this,"render"),this.collection.on("add",function(t){return e.render(t)}),this.collection.fetch()},render:function(e){var t;return $("#help").append(e.get("element")),t=e.get("initialScript"),t()}}),sbClient.View.PluginView.prototype.setPlugin=function(e){return this.collection.add(e)},u=typeof io!="undefined"&&io!==null?io.connect("http://"+location.host):void 0,u!=null&&u.on("error",function(e){return console.error("Unable to connect Socket.IO",e)}),u!=null&&u.on("connect",function(){return console.log("client connected"),$("body").on("execEmit",function(e,t){return u.emit(t.name,t)}),u.on("users",function(e){return s(e)}),u.on("move",function(e){return n("move")?r(e):!1}),u.on("plugin",function(e){var t;return!e.plugin||!e.plugin.name?!1:n(e.plugin.name)?(t=sbClient.plugins[e.plugin.name].get("callback")||{},t(e.data)):!1}),u.on("disconnect",function(){return $("body").off("execEmit"),console.log("disconnected Bye!")})}),$(function(){return i(),$(window).bind("resize",function(){return i()}),$("a").bind("click",function(e){return e.stopPropagation(),e.preventDefault(),window.open(this.href,"_blank")})})}).call(this);